<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>적격심사 입찰 분석 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: #3b82f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .system-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .version {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        .control-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .panel-header {
            background: #f1f5f9;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .panel-body {
            padding: 30px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .input-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 24px;
        }

        .section-title {
            color: #475569;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            width: 16px;
            height: 16px;
            background: #3b82f6;
            border-radius: 3px;
        }

        .form-group {
            margin-bottom: 20px;
        }

            .form-group:last-child {
                margin-bottom: 0;
            }

        label {
            display: block;
            color: #374151;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 13px;
        }

        input, select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

            input:focus, select:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }

        .input-group {
            display: flex;
            gap: 12px;
            align-items: end;
        }

            .input-group .form-group {
                flex: 1;
                margin-bottom: 0;
            }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-top: 1px solid #e2e8f0;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

            .btn-primary:hover {
                background: #2563eb;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

            .btn-secondary:hover {
                background: #4b5563;
            }

        .analysis-panel {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            background: #1e293b;
            color: white;
            padding: 16px 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .card-body {
            padding: 24px 20px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }

            .metric-row:last-child {
                border-bottom: none;
                font-weight: 600;
                color: #1e293b;
            }

        .metric-label {
            color: #64748b;
            font-size: 13px;
        }

        .metric-value {
            font-weight: 600;
            color: #1e293b;
        }

        .chart-panel {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .chart-header {
            background: #f8fafc;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-body {
            padding: 30px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .recommendation-panel {
            grid-column: 1 / -1;
            background: white;
            border: 1px solid #e2e8f0;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 24px;
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .recommendation-icon {
            width: 24px;
            height: 24px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .recommendation-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .recommendation-content {
            color: #475569;
            line-height: 1.7;
        }

        .status-bar {
            background: #1e293b;
            color: #94a3b8;
            padding: 12px 30px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
        }

        .warning-panel {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 16px;
            margin-top: 30px;
        }

        .warning-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .warning-icon {
            color: #f59e0b;
            font-weight: bold;
        }

        .warning-title {
            font-weight: 600;
            color: #92400e;
        }

        .warning-text {
            color: #92400e;
            font-size: 13px;
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .input-grid, .analysis-panel {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            .header-content {
                padding: 0 20px;
            }
        }

        @media (max-width: 640px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .action-bar {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">BS</div>
                <h1 class="system-title">Bid Strategy Optimization System</h1>
            </div>
            <div class="version">v2.1.0</div>
        </div>
    </div>

    <div class="container">
        <div class="control-panel">
            <div class="panel-header">
                <h2 class="panel-title">입찰 시뮬레이션 매개변수 설정</h2>
            </div>
            <div class="panel-body">
                <div class="input-grid">
                    <div class="input-section">
                        <div class="section-title">
                            <div class="section-icon"></div>
                            PROJECT PARAMETERS
                        </div>
                        <div class="form-group">
                            <label>추정가격 (억원)</label>
                            <input type="number" id="estimatedPrice" value="100" min="1" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>공사 분류</label>
                            <select id="constructionType">
                                <option value="building">건축공사</option>
                                <option value="civil">토목공사</option>
                                <option value="plant">플랜트공사</option>
                                <option value="electric">전기공사</option>
                                <option value="telecom">통신공사</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>낙찰하한율 (%)</label>
                            <input type="number" id="lowerLimit" value="87.745" min="80" max="95" step="0.001">
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">
                            <div class="section-icon"></div>
                            MARKET DYNAMICS
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>참여업체 수</label>
                                <input type="number" id="competitorCount" value="8" min="2" max="20">
                            </div>
                            <div class="form-group">
                                <label>시장 상황</label>
                                <select id="marketCondition">
                                    <option value="normal">보통</option>
                                    <option value="competitive">경쟁 심화</option>
                                    <option value="relaxed">경쟁 완화</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>평균 투찰률 (%)</label>
                                <input type="number" id="avgBidRate" value="88.5" min="85" max="95" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>표준편차</label>
                                <input type="number" id="bidStdDev" value="0.8" min="0.1" max="3" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">
                            <div class="section-icon"></div>
                            SIMULATION CONFIG
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>복수예비가격 수</label>
                                <input type="number" id="priceCount" value="15" min="5" max="25">
                            </div>
                            <div class="form-group">
                                <label>추첨 수</label>
                                <input type="number" id="drawCount" value="4" min="2" max="8">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>반복 횟수</label>
                            <input type="number" id="simulationCount" value="10000" min="1000" max="50000" step="1000">
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">
                            <div class="section-icon"></div>
                            HISTORICAL ADJUSTMENT
                        </div>
                        <div class="input-group">
                            <div class="form-group">
                                <label>발주처 가중치</label>
                                <input type="number" id="agencyWeight" value="1.0" min="0.5" max="2.0" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>계절 보정</label>
                                <select id="seasonAdjust">
                                    <option value="1.0">보정 없음</option>
                                    <option value="0.95">Q1 (경쟁 심화)</option>
                                    <option value="1.0">Q2 (평균)</option>
                                    <option value="1.05">Q3 (경쟁 완화)</option>
                                    <option value="0.98">Q4 (연말 효과)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>리스크 허용도</label>
                            <select id="riskTolerance">
                                <option value="conservative">보수적</option>
                                <option value="moderate">적극적</option>
                                <option value="aggressive">공격적</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <span>시스템 준비 완료</span>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="resetParameters()">
                            ↻ 초기화
                        </button>
                        <button class="btn btn-primary" onclick="executeSimulation()">
                            ▶ 시뮬레이션 실행
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-panel" id="analysisPanel">
            <div class="metric-card">
                <div class="card-header">최적화 결과</div>
                <div class="card-body" id="optimizationResults"></div>
            </div>

            <div class="metric-card">
                <div class="card-header">통계 분석</div>
                <div class="card-body" id="statisticalAnalysis"></div>
            </div>

            <div class="chart-panel">
                <div class="chart-header">
                    <h3 class="chart-title">투찰률별 낙찰 확률 분포</h3>
                    <div class="chart-controls">
                        <select id="chartType" onchange="updateChart()">
                            <option value="probability">확률 분포</option>
                            <option value="cumulative">누적 확률</option>
                        </select>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="analysisChart" width="1000" height="400"></canvas>
                </div>
            </div>

            <div class="recommendation-panel" id="recommendationPanel">
                <div class="recommendation-header">
                    <div class="recommendation-icon">✓</div>
                    <h3 class="recommendation-title">전략적 권고사항</h3>
                </div>
                <div class="recommendation-content" id="strategicRecommendation"></div>
            </div>
        </div>

        <div class="warning-panel">
            <div class="warning-header">
                <span class="warning-icon">⚠</span>
                <span class="warning-title">중요 고지사항</span>
            </div>
            <div class="warning-text">
                본 시스템은 확률론적 모델링을 통한 의사결정 지원도구입니다. 실제 입찰환경에서는 예측하지 못한 변수들이 존재할 수 있으므로,
                분석 결과는 전략 수립의 참고자료로만 활용하시고 최종 투찰 결정은 종합적 판단을 통해 이루어져야 합니다.
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-indicator"></div>
            <span>Monte Carlo Engine: Ready</span>
        </div>
        <div class="status-item">
            <span>Last Updated: 2025.09.21</span>
        </div>
        <div class="status-item">
            <span>© 2025 Bid Strategy Systems</span>
        </div>
    </div>

    <script>
        let simulationData = null;
        let currentChart = null;

        function executeSimulation() {
            const params = collectParameters();
            const results = performMonteCarloAnalysis(params);
            simulationData = results;

            displayAnalysisResults(results);
            renderChart(results);
            generateStrategicRecommendation(results, params);

            document.getElementById('analysisPanel').style.display = 'grid';
        }

        function collectParameters() {
            return {
                estimatedPrice: parseFloat(document.getElementById('estimatedPrice').value),
                lowerLimit: parseFloat(document.getElementById('lowerLimit').value),
                competitorCount: parseInt(document.getElementById('competitorCount').value),
                avgBidRate: parseFloat(document.getElementById('avgBidRate').value),
                bidStdDev: parseFloat(document.getElementById('bidStdDev').value),
                priceCount: parseInt(document.getElementById('priceCount').value),
                drawCount: parseInt(document.getElementById('drawCount').value),
                simulationCount: parseInt(document.getElementById('simulationCount').value),
                agencyWeight: parseFloat(document.getElementById('agencyWeight').value),
                seasonAdjust: parseFloat(document.getElementById('seasonAdjust').value),
                marketCondition: document.getElementById('marketCondition').value,
                riskTolerance: document.getElementById('riskTolerance').value
            };
        }

        function performMonteCarloAnalysis(params) {
            let marketMultiplier = 1.0;
            switch(params.marketCondition) {
                case 'competitive': marketMultiplier = 0.94; break;
                case 'relaxed': marketMultiplier = 1.06; break;
            }

            const adjustedBidRate = params.avgBidRate * params.agencyWeight * params.seasonAdjust * marketMultiplier;

            const bidRateRange = [];
            const probabilityDistribution = [];
            const cumulativeProbability = [];

            let maxProbability = 0;
            let optimalBidRate = 0;
            let totalWinScenarios = 0;

            for (let rate = params.lowerLimit; rate <= 94; rate += 0.03) {
                bidRateRange.push(rate);

                let winCount = 0;

                for (let iteration = 0; iteration < params.simulationCount; iteration++) {
                    const basePriceSet = generateBasePrices(params.priceCount, params.estimatedPrice);
                    const selectedPrices = randomSample(basePriceSet, params.drawCount);
                    const finalEstimatedPrice = calculateMean(selectedPrices);

                    const actualMinBid = finalEstimatedPrice * (params.lowerLimit / 100);
                    const myBidAmount = finalEstimatedPrice * (rate / 100);

                    if (myBidAmount < actualMinBid) continue;

                    let isWinning = true;
                    for (let competitor = 0; competitor < params.competitorCount - 1; competitor++) {
                        const competitorRate = generateNormalRandom(adjustedBidRate, params.bidStdDev);
                        const competitorBid = finalEstimatedPrice * (competitorRate / 100);

                        if (competitorBid >= actualMinBid && competitorBid < myBidAmount) {
                            isWinning = false;
                            break;
                        }
                    }

                    if (isWinning) winCount++;
                }

                const probability = (winCount / params.simulationCount) * 100;
                probabilityDistribution.push(probability);
                totalWinScenarios += winCount;

                if (probability > maxProbability) {
                    maxProbability = probability;
                    optimalBidRate = rate;
                }
            }

            // 누적 확률 계산
            let cumulativeSum = 0;
            for (let prob of probabilityDistribution) {
                cumulativeSum += prob;
                cumulativeProbability.push(cumulativeSum);
            }

            return {
                bidRates: bidRateRange,
                probabilities: probabilityDistribution,
                cumulativeProbabilities: cumulativeProbability,
                optimalRate: optimalBidRate,
                maxProbability: maxProbability,
                totalScenarios: params.simulationCount * bidRateRange.length,
                avgProbability: probabilityDistribution.reduce((a, b) => a + b, 0) / probabilityDistribution.length
            };
        }

        function generateBasePrices(count, basePrice) {
            const prices = [];
            for (let i = 0; i < count; i++) {
                prices.push(generateNormalRandom(basePrice, basePrice * 0.025));
            }
            return prices;
        }

        function generateNormalRandom(mean, stdDev) {
            let u = 0, v = 0;
            while(u === 0) u = Math.random();
            while(v === 0) v = Math.random();
            const z = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
            return Math.max(0, mean + z * stdDev);
        }

        function randomSample(array, count) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function calculateMean(array) {
            return array.reduce((a, b) => a + b, 0) / array.length;
        }

        function displayAnalysisResults(results) {
            const optimalIndex = results.probabilities.indexOf(results.maxProbability);
            const optimalRange = {
                lower: results.optimalRate - 0.08,
                upper: results.optimalRate + 0.08
            };

            document.getElementById('optimizationResults').innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">최적 투찰률</span>
                    <span class="metric-value">${results.optimalRate.toFixed(3)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">최대 낙찰 확률</span>
                    <span class="metric-value">${results.maxProbability.toFixed(2)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">권장 투찰 구간</span>
                    <span class="metric-value">${optimalRange.lower.toFixed(3)}% ~ ${optimalRange.upper.toFixed(3)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">위험 조정 수익률</span>
                    <span class="metric-value">${(results.maxProbability * 0.85).toFixed(1)}%</span>
                </div>
            `;

            const highProbCount = results.probabilities.filter(p => p >= 15).length;
            const competitiveIndex = results.probabilities.length > 0 ? (results.maxProbability / Math.max(...results.probabilities)) * 100 : 0;

            document.getElementById('statisticalAnalysis').innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">평균 낙찰 확률</span>
                    <span class="metric-value">${results.avgProbability.toFixed(2)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">유효 구간 수 (≥15%)</span>
                    <span class="metric-value">${highProbCount}개</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">총 시뮬레이션</span>
                    <span class="metric-value">${results.totalScenarios.toLocaleString()}회</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">신뢰도 지수</span>
                    <span class="metric-value">${competitiveIndex.toFixed(1)}/100</span>
                </div>
            `;
        }

        function renderChart(results) {
            const canvas = document.getElementById('analysisChart');
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const margin = { top: 40, right: 80, bottom: 80, left: 80 };
            const chartWidth = canvas.width - margin.left - margin.right;
            const chartHeight = canvas.height - margin.top - margin.bottom;

            // 배경 그리드
            ctx.strokeStyle = '#f1f5f9';
            ctx.lineWidth = 1;

            // 수직 그리드
            for (let i = 0; i <= 10; i++) {
                const x = margin.left + (chartWidth * i) / 10;
                ctx.beginPath();
                ctx.moveTo(x, margin.top);
                ctx.lineTo(x, margin.top + chartHeight);
                ctx.stroke();
            }

            // 수평 그리드
            for (let i = 0; i <= 8; i++) {
                const y = margin.top + (chartHeight * i) / 8;
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + chartWidth, y);
                ctx.stroke();
            }

            // 축 그리기
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + chartHeight);
            ctx.lineTo(margin.left + chartWidth, margin.top + chartHeight);
            ctx.stroke();

            // 데이터 범위
            const minRate = Math.min(...results.bidRates);
            const maxRate = Math.max(...results.bidRates);
            const maxProb = Math.max(...results.probabilities);

            // 데이터 라인 그리기
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();

            results.bidRates.forEach((rate, idx) => {
                const x = margin.left + ((rate - minRate) / (maxRate - minRate)) * chartWidth;
                const y = margin.top + chartHeight - (results.probabilities[idx] / maxProb) * chartHeight;

                if (idx === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // 최적점 표시
            const optimalIndex = results.probabilities.indexOf(results.maxProbability);
            if (optimalIndex >= 0) {
                const optimalX = margin.left + ((results.bidRates[optimalIndex] - minRate) / (maxRate - minRate)) * chartWidth;
                const optimalY = margin.top + chartHeight - (results.maxProbability / maxProb) * chartHeight;

                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(optimalX, optimalY, 6, 0, 2 * Math.PI);
                ctx.fill();

                // 최적점 레이블
                ctx.fillStyle = '#1f2937';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${results.bidRates[optimalIndex].toFixed(2)}%`, optimalX, optimalY - 15);
                ctx.fillText(`${results.maxProbability.toFixed(1)}%`, optimalX, optimalY - 30);
            }

            // X축 라벨
            ctx.fillStyle = '#6b7280';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';

            for (let i = 0; i <= 10; i++) {
                const rate = minRate + (maxRate - minRate) * i / 10;
                const x = margin.left + chartWidth * i / 10;
                ctx.fillText(rate.toFixed(1) + '%', x, margin.top + chartHeight + 25);
            }

            // Y축 라벨
            ctx.textAlign = 'right';
            for (let i = 0; i <= 8; i++) {
                const prob = maxProb * i / 8;
                const y = margin.top + chartHeight - chartHeight * i / 8;
                ctx.fillText(prob.toFixed(1) + '%', margin.left - 15, y + 4);
            }

            // 축 제목
            ctx.fillStyle = '#374151';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('투찰률 (%)', margin.left + chartWidth / 2, canvas.height - 20);

            ctx.save();
            ctx.translate(25, margin.top + chartHeight / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('낙찰 확률 (%)', 0, 0);
            ctx.restore();

            currentChart = 'probability';
        }

        function updateChart() {
            if (!simulationData) return;

            const chartType = document.getElementById('chartType').value;
            const canvas = document.getElementById('analysisChart');
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const margin = { top: 40, right: 80, bottom: 80, left: 80 };
            const chartWidth = canvas.width - margin.left - margin.right;
            const chartHeight = canvas.height - margin.top - margin.bottom;

            // 배경 그리드
            ctx.strokeStyle = '#f1f5f9';
            ctx.lineWidth = 1;

            for (let i = 0; i <= 10; i++) {
                const x = margin.left + (chartWidth * i) / 10;
                ctx.beginPath();
                ctx.moveTo(x, margin.top);
                ctx.lineTo(x, margin.top + chartHeight);
                ctx.stroke();
            }

            for (let i = 0; i <= 8; i++) {
                const y = margin.top + (chartHeight * i) / 8;
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + chartWidth, y);
                ctx.stroke();
            }

            // 축 그리기
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + chartHeight);
            ctx.lineTo(margin.left + chartWidth, margin.top + chartHeight);
            ctx.stroke();

            const minRate = Math.min(...simulationData.bidRates);
            const maxRate = Math.max(...simulationData.bidRates);

            let dataArray, maxValue, color;

            if (chartType === 'cumulative') {
                dataArray = simulationData.cumulativeProbabilities;
                maxValue = Math.max(...dataArray);
                color = '#10b981';
            } else {
                dataArray = simulationData.probabilities;
                maxValue = Math.max(...dataArray);
                color = '#3b82f6';
            }

            // 데이터 라인 그리기
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            simulationData.bidRates.forEach((rate, idx) => {
                const x = margin.left + ((rate - minRate) / (maxRate - minRate)) * chartWidth;
                const y = margin.top + chartHeight - (dataArray[idx] / maxValue) * chartHeight;

                if (idx === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // 라벨링
            ctx.fillStyle = '#6b7280';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';

            for (let i = 0; i <= 10; i++) {
                const rate = minRate + (maxRate - minRate) * i / 10;
                const x = margin.left + chartWidth * i / 10;
                ctx.fillText(rate.toFixed(1) + '%', x, margin.top + chartHeight + 25);
            }

            ctx.textAlign = 'right';
            for (let i = 0; i <= 8; i++) {
                const value = maxValue * i / 8;
                const y = margin.top + chartHeight - chartHeight * i / 8;
                ctx.fillText(value.toFixed(1) + '%', margin.left - 15, y + 4);
            }
        }

        function generateStrategicRecommendation(results, params) {
            let recommendation = '';
            let riskLevel = '';
            let strategy = '';

            if (results.maxProbability > 30) {
                riskLevel = '낮음';
                strategy = '적극적 입찰 권장';
                recommendation = `현재 시장 상황에서 <strong>${results.optimalRate.toFixed(3)}%</strong> 투찰률이 <strong>${results.maxProbability.toFixed(1)}%</strong>의 높은 낙찰 확률을 보입니다. 경쟁강도가 상대적으로 낮아 수주 기회가 우수합니다.`;
            } else if (results.maxProbability > 20) {
                riskLevel = '보통';
                strategy = '신중한 접근 필요';
                recommendation = `최적 투찰률 <strong>${results.optimalRate.toFixed(3)}%</strong>에서 <strong>${results.maxProbability.toFixed(1)}%</strong>의 중간 수준 확률을 나타냅니다. 리스크 관리와 함께 전략적 접근이 필요합니다.`;
            } else if (results.maxProbability > 10) {
                riskLevel = '높음';
                strategy = '보수적 전략 고려';
                recommendation = `고경쟁 상황으로 최대 확률이 <strong>${results.maxProbability.toFixed(1)}%</strong>에 그칩니다. 참여 여부를 신중히 검토하거나 매우 공격적인 가격 전략이 필요합니다.`;
            } else {
                riskLevel = '매우 높음';
                strategy = '참여 재검토 권장';
                recommendation = `극도로 치열한 경쟁이 예상됩니다. 현재 조건에서는 수주 확률이 <strong>${results.maxProbability.toFixed(1)}%</strong>로 매우 낮아 참여 타당성을 재검토해야 합니다.`;
            }

            const lowerBound = results.optimalRate - 0.05;
            const upperBound = results.optimalRate + 0.05;

            recommendation += `<br><br><strong>전술적 제안:</strong><br>`;
            recommendation += `• 핵심 투찰 구간: ${lowerBound.toFixed(3)}% ~ ${upperBound.toFixed(3)}%<br>`;
            recommendation += `• 위험도: ${riskLevel} | 권장 전략: ${strategy}<br>`;
            recommendation += `• 하한율 마진: +${(results.optimalRate - params.lowerLimit).toFixed(3)}%p`;

            document.getElementById('strategicRecommendation').innerHTML = recommendation;
        }

        function resetParameters() {
            const inputs = {
                'estimatedPrice': '100',
                'constructionType': 'building',
                'lowerLimit': '87.745',
                'competitorCount': '8',
                'avgBidRate': '88.5',
                'bidStdDev': '0.8',
                'priceCount': '15',
                'drawCount': '4',
                'simulationCount': '10000',
                'agencyWeight': '1.0',
                'seasonAdjust': '1.0',
                'marketCondition': 'normal',
                'riskTolerance': 'moderate'
            };

            Object.keys(inputs).forEach(id => {
                document.getElementById(id).value = inputs[id];
            });

            document.getElementById('analysisPanel').style.display = 'none';
            simulationData = null;
        }

        // 초기화 시 자동 실행
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                executeSimulation();
            }, 800);
        });
    </script>
</body>
</html>
